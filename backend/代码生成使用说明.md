# ä»£ç ç”Ÿæˆä½¿ç”¨è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®ç”Ÿæˆä»£ç 

```bash
# åŸºç¡€ç”¨æ³•ï¼šç”Ÿæˆå‰ç«¯ä»£ç  + èœå•SQL + å­—å…¸SQL
uv run fba codegen generate --sql-file <SQLæ–‡ä»¶è·¯å¾„> --app <åº”ç”¨å>

# ç¤ºä¾‹
uv run fba codegen generate --sql-file backend/sql/projects.sql --app admin

# ç”Ÿæˆå¹¶è‡ªåŠ¨æ‰§è¡ŒSQL
uv run fba codegen generate --sql-file backend/sql/projects.sql --app projects --execute
```

## ğŸ“‹ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--sql-file` | SQLæ–‡ä»¶è·¯å¾„ | `backend/sql/user.sql` |
| `--app` | åº”ç”¨åç§° | `admin`, `user`, `system` |
| `--execute` | è‡ªåŠ¨æ‰§è¡ŒSQLï¼ˆå¯é€‰ï¼‰ | åŠ ä¸Šæ­¤å‚æ•°è‡ªåŠ¨æ‰§è¡Œ |

## ğŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
å‰ç«¯ä»£ç ï¼ˆapp/è¡¨åï¼‰ï¼š
â””â”€â”€ clound-frontend/apps/web-antd/src/
    â”œâ”€â”€ views/admin/projects/    # ç›®å½•ç»“æ„ï¼šåº”ç”¨å/è¡¨å
    â”‚   â”œâ”€â”€ index.vue            # ä¸»é¡µé¢
    â”‚   â””â”€â”€ data.ts              # è¡¨æ ¼å’Œè¡¨å•é…ç½®
    â”œâ”€â”€ api/admin.ts             # APIæ¥å£
    â””â”€â”€ router/routes/modules/admin.ts  # è·¯ç”±

SQLæ–‡ä»¶ï¼š
â””â”€â”€ backend/sql/generated/
    â”œâ”€â”€ projects_menu.sql        # èœå•å’Œæƒé™SQL
    â””â”€â”€ projects_dict.sql        # å­—å…¸SQLï¼ˆå¦‚æœæœ‰ï¼‰
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ–°å»ºç”¨æˆ·ç®¡ç†æ¨¡å—

```bash
# 1. å‡†å¤‡SQLæ–‡ä»¶ï¼ˆbackend/sql/user.sqlï¼‰
# 2. æ‰§è¡Œç”Ÿæˆå‘½ä»¤
uv run fba codegen generate --sql-file backend/sql/user.sql --app user

# ç”Ÿæˆç»“æœï¼š
# - å‰ç«¯ï¼šviews/user/user/index.vue
# - APIï¼šapi/user.ts
# - è·¯ç”±ï¼šrouter/routes/modules/user.ts
# - SQLï¼šbackend/sql/generated/user_menu.sql
```

### ç¤ºä¾‹2ï¼šå¿«é€Ÿç”Ÿæˆå¹¶æ‰§è¡ŒSQL

```bash
# é€‚åˆå¼€å‘ç¯å¢ƒå¿«é€Ÿè¿­ä»£
uv run fba codegen generate --sql-file backend/sql/project.sql --app admin --execute
```

## âš™ï¸ é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ï¼š`backend/plugin/code_generator/config.toml`

### å¸¸ç”¨é…ç½®

```toml
[paths]
frontend_dir = "../clound-frontend"      # å‰ç«¯ç›®å½•
menu_sql_dir = "backend/sql/generated"   # SQLè¾“å‡ºç›®å½•

[generation]
existing_file_behavior = "skip"          # skip: è·³è¿‡å·²å­˜åœ¨æ–‡ä»¶
                                          # overwrite: è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶
auto_execute_menu_sql = false            # æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œèœå•SQL
auto_execute_dict_sql = false            # æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œå­—å…¸SQL

[dict]
# è‡ªåŠ¨è¯†åˆ«å¹¶ç”Ÿæˆå­—å…¸çš„å­—æ®µæ¨¡å¼
auto_dict_patterns = ["status", "type", "state", "level"]

# çŠ¶æ€å­—æ®µé»˜è®¤é€‰é¡¹
default_status_options = [
    { label = "å¯ç”¨", value = 1, color = "green" },
    { label = "ç¦ç”¨", value = 0, color = "red" },
]
```

## ğŸ“– SQLæ–‡ä»¶è¦æ±‚

### PostgreSQL ç¤ºä¾‹

```sql
-- æ”¯æŒ schema.table æ ¼å¼
CREATE TABLE "public"."projects" (
  "id" bigserial PRIMARY KEY,
  "name" varchar(100) NOT NULL,
  "status" integer DEFAULT 1,
  "type" varchar(50),
  "created_time" timestamp DEFAULT NOW(),
  "updated_time" timestamp
);

-- åˆ—æ³¨é‡Šï¼ˆPostgreSQLï¼‰
COMMENT ON COLUMN "public"."projects"."id" IS 'é¡¹ç›®ID';
COMMENT ON COLUMN "public"."projects"."name" IS 'é¡¹ç›®åç§°';
COMMENT ON COLUMN "public"."projects"."status" IS 'çŠ¶æ€ï¼š1-å¯ç”¨ 0-ç¦ç”¨';
```

### MySQL ç¤ºä¾‹

```sql
CREATE TABLE `projects` (
  `id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `name` varchar(100) NOT NULL COMMENT 'é¡¹ç›®åç§°',
  `status` int DEFAULT 1 COMMENT 'çŠ¶æ€',
  `type` varchar(50) COMMENT 'ç±»å‹',
  `created_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_time` datetime
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é¡¹ç›®è¡¨';
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶è¦†ç›–ä¿æŠ¤

- **é»˜è®¤è¡Œä¸º**ï¼šè·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶ï¼ˆ`skip`ï¼‰
- **å¦‚ä½•ä¿®æ”¹**ï¼šç¼–è¾‘ `config.toml` ä¸­çš„ `existing_file_behavior`
- **æ¨è**ï¼šé¦–æ¬¡ç”Ÿæˆåï¼Œæ‰‹åŠ¨ä¿®æ”¹ä»£ç ä¸ä¼šè¢«è¦†ç›–
- **æ™ºèƒ½è·³è¿‡**ï¼šå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨è·³è¿‡ä¸”ä¸æŠ¥é”™
- **è·¯ç”±è¿½åŠ **ï¼šåç«¯ router.py æ–‡ä»¶ä¼šæ™ºèƒ½è¿½åŠ æ–°è·¯ç”±ï¼Œä¸ä¼šè¦†ç›–ç°æœ‰é…ç½®
- **__init__.py è¿½åŠ **ï¼šmodel/__init__.py ç­‰æ–‡ä»¶ä¼šæ™ºèƒ½è¿½åŠ æ–°çš„ importï¼Œè€Œä¸æ˜¯è¦†ç›–

### 2. åç«¯ä»£ç ç”Ÿæˆ

åç«¯ä»£ç éœ€è¦ä½¿ç”¨åŸæ¡†æ¶å‘½ä»¤ï¼ˆä¸¤æ­¥ï¼‰ï¼š

```bash
# æ­¥éª¤1ï¼šå¯¼å…¥è¡¨ä¿¡æ¯åˆ°æ•°æ®åº“
uv run fba codegen import --app admin --tn projects

# æ­¥éª¤2ï¼šäº¤äº’å¼ç”Ÿæˆä»£ç 
uv run fba codegen
```

### 3. å­—å…¸è‡ªåŠ¨ç”Ÿæˆ

å­—å…¸SQLä»…åœ¨å­—æ®µååŒ¹é…ä»¥ä¸‹æ¨¡å¼æ—¶ç”Ÿæˆï¼š
- `status` - çŠ¶æ€å­—æ®µ
- `type` - ç±»å‹å­—æ®µ
- `state` - çŠ¶æ€å­—æ®µ
- `level` - çº§åˆ«å­—æ®µ

å¯åœ¨ `config.toml` ä¸­è‡ªå®šä¹‰æ¨¡å¼å’Œé€‰é¡¹ã€‚

### 4. ç›®å½•ç»“æ„è§„èŒƒ

- **å‰ç«¯ç›®å½•**ï¼š`views/åº”ç”¨å/è¡¨å/`
- **åç«¯ç›®å½•**ï¼š`app/åº”ç”¨å/è¡¨å/`
- **ç¤ºä¾‹**ï¼š
  - åº”ç”¨åï¼š`admin`
  - è¡¨åï¼š`projects`
  - å‰ç«¯è·¯å¾„ï¼š`views/admin/projects/index.vue`

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: ç”Ÿæˆçš„æ–‡ä»¶ä½ç½®ä¸å¯¹ï¼Ÿ

**A:** æ£€æŸ¥ `config.toml` ä¸­çš„ `frontend_dir` é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

### Q: æ²¡æœ‰ç”Ÿæˆå­—å…¸SQLï¼Ÿ

**A:** ç¡®ä¿å­—æ®µååŒ…å« `status`ã€`type`ã€`state` æˆ– `level`ã€‚å¯åœ¨ `config.toml` ä¸­æ·»åŠ è‡ªå®šä¹‰æ¨¡å¼ã€‚

### Q: èœå•SQLéœ€è¦å…³è”çˆ¶çº§èœå•ï¼Ÿ

**A:** åœ¨ `config.toml` ä¸­è®¾ç½®ï¼š
```toml
[menu]
parent_menu_id = 123  # çˆ¶çº§èœå•ID
```

### Q: å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼Ÿ

**A:** 
```bash
uv run fba codegen --help
```

## ğŸ“š ç›¸å…³å‘½ä»¤å¯¹æ¯”

| åŠŸèƒ½ | æ–°å‘½ä»¤ | åŸå‘½ä»¤ |
|------|--------|--------|
| ç”Ÿæˆå‰ç«¯ä»£ç  | `fba codegen generate` | `fba codegen frontend` |
| ç”Ÿæˆèœå•SQL | è‡ªåŠ¨ç”Ÿæˆ | `fba codegen menu` |
| ç”Ÿæˆå­—å…¸SQL | è‡ªåŠ¨ç”Ÿæˆ | æ—  |
| ç”Ÿæˆåç«¯ä»£ç  | æš‚ä¸æ”¯æŒ | `fba codegen import` + `fba codegen` |

## âœ… å¿«é€Ÿæ£€æŸ¥æ¸…å•

ç”Ÿæˆä»£ç å‰æ£€æŸ¥ï¼š
- [ ] SQLæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- [ ] è¡¨åå’Œå­—æ®µåä½¿ç”¨ snake_case æ ¼å¼
- [ ] é‡è¦å­—æ®µæ·»åŠ äº†æ³¨é‡Š
- [ ] åº”ç”¨åç§°å·²ç¡®å®š
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®

ç”Ÿæˆä»£ç åæ£€æŸ¥ï¼š
- [ ] å‰ç«¯æ–‡ä»¶å·²ç”Ÿæˆï¼ˆ`views/app/table/`ï¼‰
- [ ] APIå’Œè·¯ç”±æ–‡ä»¶å·²æ›´æ–°
- [ ] èœå•SQLæ–‡ä»¶å·²ç”Ÿæˆ
- [ ] å¦‚æœæœ‰å­—å…¸å­—æ®µï¼Œå­—å…¸SQLå·²ç”Ÿæˆ

---

**å®Œæ•´æ–‡æ¡£**ï¼šæŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `CODE_GENERATION_GUIDE.md`

**éœ€è¦å¸®åŠ©ï¼Ÿ** è”ç³»é¡¹ç›®ç»´æŠ¤è€…æˆ–æäº¤Issue
